# see https://github.com/eqrion/cbindgen/blob/master/docs.md

# platform defines derived from: https://loumalouomega.github.io/OSPreprocessor/

header ="""
// libgosling header autogenerated by cbindgen, do not modify
#ifndef LIBGOSLING_H
#define LIBGOSLING_H

// gosling platform defines
#if (defined(_WIN32) || defined(_WIN64))
#   define GOSLING_PLATFORM_WINDOWS
#elif (defined(__linux__) || defined(__linux) || defined(linux) || defined(__gnu_linux__))
#   define GOSLING_PLATFORM_LINUX
#elif (defined(__APPLE__) && defined(__MACH__))
#   define GOSLING_PLATFORM_MACOS
#endif"""

after_includes = """

// per-platform includes
#if defined(GOSLING_PLATFORM_WINDOWS)
#   include <winsock2.h>
#elif defined(GOSLING_PLATFORM_LINUX) || defined(GOSLING_PLATFORM_MACOS)
#   include <sys/socket.h>
#endif"""

trailer="""
// gosling constants
enum {
    gosling_v3_onion_service_id_string_length = 56,
    gosling_v3_onion_service_id_string_size = 57,
    gosling_ed25519_private_key_keyblob_base64_length = 88,
    gosling_ed25519_private_key_keyblob_header_length = 11,
    gosling_ed25519_private_key_keyblob_length = 99,
    gosling_ed25519_private_key_keyblob_size = 100,
    gosling_x25519_private_key_base64_length = 44,
    gosling_x25519_private_key_base64_size = 45,
    gosling_x25519_public_key_base32_length = 52,
    gosling_x25519_public_key_base32_size = 53,
};

// ensure enum constants match our acro definitions
static_assert(gosling_v3_onion_service_id_string_length == V3_ONION_SERVICE_ID_STRING_LENGTH, "");
static_assert(gosling_v3_onion_service_id_string_size == V3_ONION_SERVICE_ID_STRING_SIZE, "");
static_assert(gosling_ed25519_private_key_keyblob_base64_length == ED25519_PRIVATE_KEYBLOB_BASE64_LENGTH, "");
static_assert(gosling_ed25519_private_key_keyblob_header_length == ED25519_PRIVATE_KEY_KEYBLOB_HEADER_LENGTH, "");
static_assert(gosling_ed25519_private_key_keyblob_length == ED25519_PRIVATE_KEY_KEYBLOB_LENGTH, "");
static_assert(gosling_ed25519_private_key_keyblob_size == ED25519_PRIVATE_KEY_KEYBLOB_SIZE, "");
static_assert(gosling_x25519_private_key_base64_length == X25519_PRIVATE_KEY_BASE64_LENGTH, "");
static_assert(gosling_x25519_private_key_base64_size == X25519_PRIVATE_KEY_BASE64_SIZE, "");
static_assert(gosling_x25519_public_key_base32_length == X25519_PUBLIC_KEY_BASE32_LENGTH, "");
static_assert(gosling_x25519_public_key_base32_size == X25519_PUBLIC_KEY_BASE32_SIZE, "");

#endif /* LIBGOSLING_H */
"""

tab_width = 4
language = "C"
cpp_compat = true
sys_includes = ["assert.h"]
usize_is_size_t = true
documentation = true
documentation_style = "doxy"
line_length = 80
only_target_dependencies = true

[parse]
parse_deps = true
include = ["tor-interface"]
extra_bindings = ["tor-interface"]

[defines]
"target_os = windows" = "GOSLING_PLATFORM_WINDOWS"
"target_os = linux" = "GOSLING_PLATFORM_LINUX"
"target_os = macos" = "GOSLING_PLATFORM_MACOS"

[fn]
args = "horizontal"

[enum]
rename_variants = "SnakeCase"
enum_class = true
prefix_with_name = true

[export.rename]
"RawSocket" = "SOCKET"
"RawFd" = "int"

# typedefs
GoslingHandshakeHandle = "gosling_handshake_handle_t"

# structs

GoslingLibrary = "gosling_library"
GoslingFFIError = "gosling_error"
GoslingContext = "gosling_context"
GoslingEd25519PrivateKey = "gosling_ed25519_private_key"
GoslingV3OnionServiceId = "gosling_v3_onion_service_id"
GoslingX25519PrivateKey = "gosling_x25519_private_key"
GoslingX25519PublicKey = "gosling_x25519_public_key"
GoslingTorProvider = "gosling_tor_provider"

# callbacks

GoslingEndpointClientHandshakeCompletedCallback = "gosling_endpoint_client_handshake_completed_callback_t"
GoslingEndpointClientHandshakeFailedCallback = "gosling_endpoint_client_handshake_failed_callback_t"
GoslingEndpointServerChannelSupportedCallback = "gosling_endpoint_server_channel_supported_callback_t"
GoslingEndpointServerHandshakeCompletedCallback = "gosling_endpoint_server_handshake_completed_callback_t"
GoslingEndpointServerHandshakeFailedCallback = "gosling_endpoint_server_handshake_failed_callback_t"
GoslingEndpointServerHandshakeRejectedCallback = "gosling_endpoint_server_handshake_rejected_callback_t"
GoslingEndpointServerHandshakeStartedCallback = "gosling_endpoint_server_handshake_started_callback_t"
GoslingEndpointServerPublishedCallback = "gosling_endpoint_server_published_callback_t"
GoslingIdentityClientHandshakeBuildChallengeResponseCallback = "gosling_identity_client_handshake_build_challenge_response_callback_t"
GoslingIdentityClientHandshakeChallengeResponseSizeCallback = "gosling_identity_client_handshake_challenge_response_size_callback_t"
GoslingIdentityClientHandshakeCompletedCallback = "gosling_identity_client_handshake_completed_callback_t"
GoslingIdentityClientHandshakeFailedCallback = "gosling_identity_client_handshake_failed_callback_t"
GoslingIdentityServerEndpointSupportedCallback = "gosling_identity_server_endpoint_supported_callback_t"
GoslingIdentityServerHandshakeBuildChallengeCallback = "gosling_identity_server_handshake_build_challenge_callback_t"
GoslingIdentityServerHandshakeChallengeSizeCallback = "gosling_identity_server_handshake_challenge_size_callback_t"
GoslingIdentityServerHandshakeClientAllowedCallback = "gosling_identity_server_handshake_client_allowed_callback_t"
GoslingIdentityServerHandshakeCompletedCallback = "gosling_identity_server_handshake_completed_callback_t"
GoslingIdentityServerHandshakeFailedCallback = "gosling_identity_server_handshake_failed_callback_t"
GoslingIdentityServerHandshakeRejectedCallback = "gosling_identity_server_handshake_rejected_callback_t"
GoslingIdentityServerHandshakeStartedCallback = "gosling_identity_server_handshake_started_callback_t"
GoslingIdentityServerHandshakeVerifyChallengeResponseCallback = "gosling_identity_server_handshake_verify_challenge_response_callback_t"
GoslingIdentityServerPublishedCallback = "gosling_identity_server_published_callback_t"
GoslingTorBootstrapCompletedCallback = "gosling_tor_bootstrap_completed_callback_t"
GoslingTorBootstrapStatusReceivedCallback = "gosling_tor_bootstrap_status_received_callback_t"
GoslingTorLogReceivedCallback = "gosling_tor_log_received_callback_t"
