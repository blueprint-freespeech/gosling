<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="585px" preserveAspectRatio="none" style="width:337px;height:585px;" version="1.1" viewBox="0 0 337 585" width="337px" zoomAndPan="magnify"><defs><filter height="300%" id="fombtnolwvqif" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fombtnolwvqif)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="300" x="13" y="123.5625"/><rect fill="#FFFFFF" filter="url(#fombtnolwvqif)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="300" x="13" y="359.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="38.2969" y2="545.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="235.5" x2="235.5" y1="38.2969" y2="545.2891"/><rect fill="#FEFECE" filter="url(#fombtnolwvqif)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="22.9951">Client</text><rect fill="#FEFECE" filter="url(#fombtnolwvqif)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="544.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="564.2842">Client</text><rect fill="#FEFECE" filter="url(#fombtnolwvqif)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="171.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="178.5" y="22.9951">Endpoint Server</text><rect fill="#FEFECE" filter="url(#fombtnolwvqif)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="171.5" y="544.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="178.5" y="564.2842">Endpoint Server</text><polygon fill="#A80036" points="223.5,65.4297,233.5,69.4297,223.5,73.4297,227.5,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="229.5" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="58.5" y="64.3638">begin_handshake(...)</text><path d="M141,82.4297 L141,107.4297 L325,107.4297 L325,92.4297 L315,82.4297 L141,82.4297 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M315,82.4297 L315,92.4297 L325,92.4297 L315,82.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="147" y="99.4966">Evaluate Protocol Version</text><path d="M13,123.5625 L77,123.5625 L77,130.5625 L67,140.5625 L13,140.5625 L13,123.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="300" x="13" y="123.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="136.6294">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="92" y="135.7729">[Unsupported Version]</text><polygon fill="#A80036" points="62.5,157.8281,52.5,161.8281,62.5,165.8281,58.5,161.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="234.5" y1="161.8281" y2="161.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="68.5" y="156.7622">error</text><path d="M167,174.8281 L167,199.8281 L299,199.8281 L299,184.8281 L289,174.8281 L167,174.8281 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M289,174.8281 L289,184.8281 L299,184.8281 L289,174.8281 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="173" y="191.895">Close Connection</text><polygon fill="#A80036" points="62.5,233.0938,52.5,237.0938,62.5,241.0938,58.5,237.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="234.5" y1="237.0938" y2="237.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="68.5" y="232.0278">return {    server cookie}</text><polygon fill="#A80036" points="223.5,262.2266,233.5,266.2266,223.5,270.2266,227.5,266.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="229.5" y1="266.2266" y2="266.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="58.5" y="261.1606">send_response(...)</text><path d="M152,279.2266 L152,304.2266 L315,304.2266 L315,289.2266 L305,279.2266 L152,279.2266 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M305,279.2266 L305,289.2266 L315,289.2266 L305,279.2266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="158" y="296.2935">Check Client Allow-List</text><path d="M165,318.3594 L165,343.3594 L302,343.3594 L302,328.3594 L292,318.3594 L165,318.3594 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M292,318.3594 L292,328.3594 L302,328.3594 L292,318.3594 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="171" y="335.4263">Check Client Proof</text><path d="M13,359.4922 L77,359.4922 L77,366.4922 L67,376.4922 L13,376.4922 L13,359.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="300" x="13" y="359.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="372.5591">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="92" y="371.7026">[Any Check Failed]</text><polygon fill="#A80036" points="62.5,393.7578,52.5,397.7578,62.5,401.7578,58.5,397.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="234.5" y1="397.7578" y2="397.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="68.5" y="392.6919">error</text><path d="M167,410.7578 L167,435.7578 L299,435.7578 L299,420.7578 L289,410.7578 L167,410.7578 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M289,410.7578 L289,420.7578 L299,420.7578 L289,410.7578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="173" y="427.8247">Close Connection</text><polygon fill="#A80036" points="62.5,469.0234,52.5,473.0234,62.5,477.0234,58.5,473.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="234.5" y1="473.0234" y2="473.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="68.5" y="467.9575">return {}</text><path d="M8,486.0234 L8,526.0234 L279,526.0234 L279,496.0234 L269,486.0234 L8,486.0234 " fill="#FBFB77" filter="url(#fombtnolwvqif)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M269,486.0234 L269,496.0234 L279,496.0234 L269,486.0234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="28.25" y="503.0903">RPC session ends and TCP stream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="28.25" y="518.2231">control given to application</text><!--
@startuml
participant Client
participant "Endpoint Server" as Server

Client->Server: begin_handshake(...)

    note over Server: Evaluate Protocol Version

    alt Unsupported Version
        Client<-Server: error
        note over Server: Close Connection
    end

Client<-Server: return {    server cookie}

Client->Server: send_response(...)

    note over Server: Check Client Allow-List
    note over Server: Check Client Proof

    alt Any Check Failed
        Client<-Server: error
        note over Server: Close Connection
    end

Server->Client: return {}

note over Client, Server
    RPC session ends and TCP stream
    control given to application
endnote
@enduml

PlantUML version 1.2018.13(Mon Nov 26 17:11:51 UTC 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.16+8-post-Ubuntu-0ubuntu120.04
Operating System: Linux
OS Version: 5.15.0-46-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>