<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="991px" preserveAspectRatio="none" style="width:359px;height:991px;" version="1.1" viewBox="0 0 359 991" width="359px" zoomAndPan="magnify"><defs><filter height="300%" id="fu3fp29n76u2o" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fu3fp29n76u2o)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="123.5625"/><rect fill="#FFFFFF" filter="url(#fu3fp29n76u2o)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="262.0938"/><rect fill="#FFFFFF" filter="url(#fu3fp29n76u2o)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="458.8906"/><rect fill="#FFFFFF" filter="url(#fu3fp29n76u2o)" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="655.6875"/><rect fill="#FFFFFF" filter="url(#fu3fp29n76u2o)" height="56.2656" style="stroke: #000000; stroke-width: 2.0;" width="285" x="63" y="794.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="53" x2="53" y1="38.2969" y2="950.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="205.5" x2="205.5" y1="38.2969" y2="950.8828"/><rect fill="#FEFECE" filter="url(#fu3fp29n76u2o)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="25" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="32" y="22.9951">Client</text><rect fill="#FEFECE" filter="url(#fu3fp29n76u2o)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="25" y="949.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="32" y="969.8779">Client</text><rect fill="#FEFECE" filter="url(#fu3fp29n76u2o)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="141.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="148.5" y="22.9951">Endpoint Server</text><rect fill="#FEFECE" filter="url(#fu3fp29n76u2o)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="141.5" y="949.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="148.5" y="969.8779">Endpoint Server</text><polygon fill="#A80036" points="193.5,65.4297,203.5,69.4297,193.5,73.4297,197.5,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="199.5" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="60.5" y="64.3638">begin_handshake()</text><path d="M111,82.4297 L111,107.4297 L295,107.4297 L295,92.4297 L285,82.4297 L111,82.4297 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M285,82.4297 L285,92.4297 L295,92.4297 L285,82.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="117" y="99.4966">Evaluate Protocol Version</text><path d="M15,123.5625 L79,123.5625 L79,130.5625 L69,140.5625 L15,140.5625 L15,123.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="123.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="30" y="136.6294">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="94" y="135.7729">[Unsupported Version]</text><polygon fill="#A80036" points="64.5,157.8281,54.5,161.8281,64.5,165.8281,60.5,161.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="161.8281" y2="161.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="70.5" y="156.7622">error</text><path d="M137,174.8281 L137,199.8281 L269,199.8281 L269,184.8281 L259,174.8281 L137,174.8281 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259,174.8281 L259,184.8281 L269,184.8281 L259,174.8281 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="143" y="191.895">Close Connection</text><path d="M122,220.9609 L122,245.9609 L285,245.9609 L285,230.9609 L275,220.9609 L122,220.9609 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M275,220.9609 L275,230.9609 L285,230.9609 L275,220.9609 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="128" y="238.0278">Check Client Allow-List</text><path d="M15,262.0938 L79,262.0938 L79,269.0938 L69,279.0938 L15,279.0938 L15,262.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="262.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="30" y="275.1606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="94" y="274.3042">[Client Blocked]</text><polygon fill="#A80036" points="64.5,296.3594,54.5,300.3594,64.5,304.3594,60.5,300.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="300.3594" y2="300.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="70.5" y="295.2935">error</text><path d="M137,313.3594 L137,338.3594 L269,338.3594 L269,323.3594 L259,313.3594 L137,313.3594 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259,313.3594 L259,323.3594 L269,323.3594 L259,313.3594 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="143" y="330.4263">Close Connection</text><polygon fill="#A80036" points="64.5,371.625,54.5,375.625,64.5,379.625,60.5,375.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="375.625" y2="375.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="70.5" y="370.5591">return server cookie</text><polygon fill="#A80036" points="193.5,400.7578,203.5,404.7578,193.5,408.7578,197.5,404.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="199.5" y1="404.7578" y2="404.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="60.5" y="399.6919">send_client_proof()</text><path d="M127,417.7578 L127,442.7578 L280,442.7578 L280,427.7578 L270,417.7578 L127,417.7578 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M270,417.7578 L270,427.7578 L280,427.7578 L270,417.7578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="133" y="434.8247">Evaluate Client Proof</text><path d="M15,458.8906 L79,458.8906 L79,465.8906 L69,475.8906 L15,475.8906 L15,458.8906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="458.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="30" y="471.9575">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="94" y="471.1011">[Invalid Proof]</text><polygon fill="#A80036" points="64.5,493.1563,54.5,497.1563,64.5,501.1563,60.5,497.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="497.1563" y2="497.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="70.5" y="492.0903">error</text><path d="M137,510.1563 L137,535.1563 L269,535.1563 L269,520.1563 L259,510.1563 L137,510.1563 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259,510.1563 L259,520.1563 L269,520.1563 L259,510.1563 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="143" y="527.2231">Close Connection</text><polygon fill="#A80036" points="64.5,568.4219,54.5,572.4219,64.5,576.4219,60.5,572.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="572.4219" y2="572.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="70.5" y="567.356">return</text><polygon fill="#A80036" points="193.5,597.5547,203.5,601.5547,193.5,605.5547,197.5,601.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="199.5" y1="601.5547" y2="601.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="60.5" y="596.4888">open_endpoint()</text><path d="M135,614.5547 L135,639.5547 L271,639.5547 L271,624.5547 L261,614.5547 L135,614.5547 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M261,614.5547 L261,624.5547 L271,624.5547 L261,614.5547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="141" y="631.6216">Evaluate Endpoint</text><path d="M15,655.6875 L79,655.6875 L79,662.6875 L69,672.6875 L15,672.6875 L15,655.6875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.3984" style="stroke: #000000; stroke-width: 2.0;" width="268" x="15" y="655.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="30" y="668.7544">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="94" y="667.8979">[Invalid Service Endpoint]</text><polygon fill="#A80036" points="64.5,689.9531,54.5,693.9531,64.5,697.9531,60.5,693.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="693.9531" y2="693.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="70.5" y="688.8872">error</text><path d="M137,706.9531 L137,731.9531 L269,731.9531 L269,716.9531 L259,706.9531 L137,706.9531 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259,706.9531 L259,716.9531 L269,716.9531 L259,706.9531 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="143" y="724.02">Close Connection</text><path d="M137,753.0859 L137,778.0859 L269,778.0859 L269,763.0859 L259,753.0859 L137,753.0859 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259,753.0859 L259,763.0859 L269,763.0859 L259,753.0859 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="143" y="770.1528">Evaluate Channel</text><path d="M63,794.2188 L127,794.2188 L127,801.2188 L117,811.2188 L63,811.2188 L63,794.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="56.2656" style="stroke: #000000; stroke-width: 2.0;" width="285" x="63" y="794.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="78" y="807.2856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="142" y="806.4292">[Channel Already Open]</text><path d="M73,816.3516 L73,841.3516 L334,841.3516 L334,826.3516 L324,816.3516 L73,816.3516 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M324,816.3516 L324,826.3516 L334,826.3516 L324,816.3516 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="79" y="833.4185">Close Existing Connection on Channel</text><polygon fill="#A80036" points="64.5,874.6172,54.5,878.6172,64.5,882.6172,60.5,878.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58.5" x2="204.5" y1="878.6172" y2="878.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="70.5" y="873.5513">return</text><path d="M8,891.6172 L8,931.6172 L247,931.6172 L247,901.6172 L237,891.6172 L8,891.6172 " fill="#FBFB77" filter="url(#fu3fp29n76u2o)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M237,891.6172 L237,901.6172 L247,901.6172 L237,891.6172 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="14" y="908.6841">RPC session ends and TCP stream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="14" y="923.8169">control given to application</text><!--
@startuml
participant Client
participant "Endpoint Server" as Server

Client->Server: begin_handshake()

    note over Server: Evaluate Protocol Version

    alt Unsupported Version
        Client<-Server: error
        note over Server: Close Connection
    end

    note over Server: Check Client Allow-List

    alt Client Blocked
        Client<-Server: error
        note over Server: Close Connection
    end

Client<-Server: return server cookie

Client->Server: send_client_proof()

    note over Server: Evaluate Client Proof

    alt Invalid Proof
        Client<-Server: error
        note over Server: Close Connection
    end

Server->Client: return

Client->Server: open_endpoint()
    note over Server: Evaluate Endpoint

    alt Invalid Service Endpoint
        Client<-Server: error
        note over Server: Close Connection
    end

    note over Server: Evaluate Channel

    alt Channel Already Open
        note over Server: Close Existing Connection on Channel
    end

    Client<-Server: return

note over Client, Server
    RPC session ends and TCP stream
    control given to application
endnote

@enduml

PlantUML version 1.2018.13(Mon Nov 26 17:11:51 UTC 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.15+10-Ubuntu-0ubuntu0.20.04.1
Operating System: Linux
OS Version: 5.13.0-40-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>